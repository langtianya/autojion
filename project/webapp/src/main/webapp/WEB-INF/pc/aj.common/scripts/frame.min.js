$(function(){$("body").i18n();function b(e){return/^(\w+):\/\//.test(e)}function m(e){if(!b(e)){e=contextPath+e}if(e.indexOf("?")!=-1){return e+"&v="+window.frameVersion}else{return e+"?v="+window.frameVersion}}$("#frame_home").attr("src",m(homeUrl));var r=[{value:"default",text:$.i18n.get("theme.default"),group:$.i18n.get("theme.group.base")},{value:"metro",text:$.i18n.get("theme.metro"),group:$.i18n.get("theme.group.base")},{value:"bootstrap",text:$.i18n.get("theme.bootstrap"),group:$.i18n.get("theme.group.base")},{value:"black",text:$.i18n.get("theme.black"),group:$.i18n.get("theme.group.base")},{value:"light-blue",text:$.i18n.get("theme.light-blue"),group:$.i18n.get("theme.group.ui")},{value:"ui-cupertino",text:$.i18n.get("theme.ui-cupertino"),group:$.i18n.get("theme.group.ui")},{value:"ui-dark-hive",text:$.i18n.get("theme.ui-dark-hive"),group:$.i18n.get("theme.group.ui")},{value:"ui-pepper-grinder",text:$.i18n.get("theme.ui-pepper-grinder"),group:$.i18n.get("theme.group.ui")},{value:"ui-sunny",text:$.i18n.get("theme.ui-sunny"),group:$.i18n.get("theme.group.ui")}];function s(){var y=new Date();var B="";var C=y.getYear();if(C<1900){C=C+1900}var A=y.getMonth()+1;if(A<10){A="0"+A}var e=y.getDate();if(e<10){e="0"+e}var z=y.getDay();B=C+"-"+A+"-"+e+" "+$.i18n.get("week.day"+z);$("#time").html(B)}window.closeAllTabs=function(){hideMenuCoverLeft();var e=$("#mainTab").tabs("tabs");$.each(e,function(y){$("#mainTab").tabs("close",1)})};window.changePwd=function(){hideMenuCoverLeft();window.open(contextPath+"/password.pub")};window.goBackHome=function(){hideMenuCoverLeft();$("#mainTab").tabs("select",0)};window.infoSetting=function(e){hideMenuCoverLeft();var C=$.i18n.get("versionAndSetting");var z=$("#mainTab");if(z.tabs("exists",C)){z.tabs("select",C)}else{$("#versionAndSetting select.theme").addClass("easyui-combobox");$("#versionAndSetting select.role").addClass("easyui-combobox");var y=$("#versionAndSetting").html();var B=z.tabs("add",{id:"tab_versionAndSetting__",title:C,content:y,iconCls:"icon-version",closable:true,selected:e===true});var A=$("#tab_versionAndSetting__ select.theme");A.combobox({groupField:"group",data:r,editable:false,panelHeight:"auto",onChange:h,onLoadSuccess:function(){A.combobox("setValue",currentTheme)}});$("#tab_versionAndSetting__ select.lang").combobox({editable:false,panelHeight:"auto",onLoadSuccess:function(){$(this).combobox("setValue",currentLanguage)},onChange:function(D){if(D!=currentLanguage){window.location.href="frame.pvt?request_locale="+D+"&inSetting=true"}}});l($("#tab_versionAndSetting__ select.role"))}};function h(e){if(e!=currentTheme){$.ajax({type:"post",url:contextPath+"/switchTheme.pvt",data:{theme:e},success:function(A,y,z){if(!A.success&&A.msg!=null){$.messager.alert($.i18n.get("error"),A.msg,"error",function(){window.location.href="frame.pvt?inSetting=true"})}else{window.location.href="frame.pvt?inSetting=true"}},error:function(A,y,z){$.messager.alert($.i18n.get("error"),z||$.i18n.get("prompt.connection.exception"),"error")}})}}window.userRoleLoad=false;function l(e){if(e.length==0){return}if(userRoleLoad){i(e,userRoles||[])}else{userRoleLoad=true;$.ajax({type:"post",url:contextPath+"/userRoles.pvt",success:function(z,y,A){if(!z.success&&z.msg!=undefined){$.messager.alert($.i18n.get("error"),z.msg,"error")}else{if(z.success){window.userRoles=z.userRoles;i(e,userRoles||[])}}},error:function(A,y,z){$.messager.alert($.i18n.get("error"),z||$.i18n.get("prompt.connection.exception"),"error")}})}}function i(y,e){y.combobox({editable:false,panelHeight:"auto",data:e,valueField:"roleId",textField:"roleName",onChange:o,onLoadSuccess:function(){$(this).combobox("setValue",currentRoleId)}})}function o(e){if(e!=currentRoleId){$.ajax({type:"post",url:contextPath+"/switchRole.pvt",data:{roleId:e},success:function(A,y,z){window.location.href="frame.pvt?inSetting=true"},error:function(A,y,z){$.messager.alert($.i18n.get("error"),z||$.i18n.get("prompt.connection.exception"),"error")}})}}window.checkLoginPopupShow=false;window.checkLogin=function(){if(window.checkLoginPopupShow===false){$.ajax({url:contextPath+"/checkLogin.pub",cache:false,success:function(z,e,y){if(z!=="true"){window.checkLoginPopupShow=true;$.messager.alert($.i18n.get("prompt"),$.i18n.get("prompt.sessionTimeout"),"info",function(){window.location.href=window.location.href})}}})}};try{setInterval("checkLogin()",sessionTimeout)}catch(t){}var p={};var u={};var q={};function g(A){var z=$(A.target);var y=z.closest("div");if(y.length>0&&y[0].id=="menu-tools"){return false}if(z.closest("a").hasClass("menuLock")){return false}if(0==z.closest(".menu-cover-left").length){hideMenuCoverLeft();$(document).off("click",g)}}window.menuCoverLeft=function(e){var y=$("#menuCoverDiv");if(y.css("left")=="0px"){return false}if(e===true){y.css("left",0)}else{y.append($("#menu").removeClass("hidden")).animate({left:0},{duration:600,step:function(z,A){y.css("left",z)}})}$(document).on("click",g);y.mouseleave(hideMenuCoverLeft)};window.hideMenuCoverLeft=function(e){var y=$("#menuCoverDiv");if(y.css("left")=="-218px"){return false}if(e===true){y.css("left",-218)}else{y.animate({left:-218},{duration:600,step:function(z,A){y.css("left",z)}})}$("#menu-tool_in_out").linkbutton("unselect");y.off("mouseleave",hideMenuCoverLeft)};function v(){var e=$("#menuCoverDiv");e.css("left",0);e.append($("#menu").removeClass("hidden")).animate({left:-218},{duration:600,step:function(y,z){e.css("left",y)}});$("#menu-tool_in_out").linkbutton("unselect");e.off("mouseleave",hideMenuCoverLeft)}window.menuLock=false;window.toggleMenuLock=function(){if(!menuLock){$(".menuLock").addClass("locked")}else{$(".menuLock").removeClass("locked")}if(menuLock){menuIn();v()}else{x(true)}menuLock=!menuLock;if(menuLock){n()}$("#menu-tool_in_out").linkbutton(menuLock?"select":"unselect")};window.toggleMenu=function(){var e=$("#menu-tool_in_out").hasClass("l-btn-selected");e?x():n()};function n(e){menuLock?menuOut():menuCoverLeft(e===true)}function x(e){menuLock?menuIn():hideMenuCoverLeft(e===true)}$("#menuCoverDiv .menuLock").bind("click",toggleMenuLock);window.menuIn=function(){$("body").append($("#menu").addClass("hidden"));$("#menuDiv").empty();$("#menu-tools").removeClass("noLogoImg").prepend($("#sfLogoImg"));$("#mainLayout").layout("remove","west")};window.menuOut=function(){$("#menu-tools").addClass("noLogoImg");$("#mainLayout").layout("add",{id:"menuDiv",region:"west",width:210,height:2000,title:"&nbsp;",collapsible:false});$(".layout-panel-west .panel-header").append($("<a href='#' class='menuLock reverse'></a>").linkbutton({plain:true}).bind("click",function(){toggleMenuLock()}));$(".layout-panel-west .panel-header .panel-title").prepend($("#sfLogoImg"));$("#menuDiv").append($("#menu").removeClass("hidden"))};var w=navigator.userAgent.toLowerCase();$.browser={webkit:/webkit/.test(w),chrome:/(chrome)\/([\w.]+)/.test(w),msie:/(msie\s|trident.*rv:)([\w.]+)/.test(w)};window.onMenuClick=function(z,y,D,B){if(B==""||B==undefined){return}var F=$.i18n.get(z+".name");if(F==undefined||F==null||F==""){F=y}var E=$("#mainTab");if(E.tabs("exists",F)){hideMenuCoverLeft();E.tabs("select",F)}else{var C=E.tabs("add",{id:"tab_"+z,title:F,iconCls:D,content:"<div class='tab_content_div'><iframe id=\"frame_"+z+'" class=\'tab_content_iframe\' frameborder="no" scrolling="no"></iframe></div>',closable:true,selected:true});$("#frame_"+z).attr("src",m(B));if($.browser.msie){var A=window.frames["frame_"+z];var e=function(){state=A.document.readyState;if("complete"==state){hideMenuCoverLeft()}};document.getElementById("frame_"+z).onreadystatechange=e}else{document.getElementById("frame_"+z).onload=function(){hideMenuCoverLeft()}}}};window.onOpenMenuChild=function(C,B,A,y,z,e){if(e&&!p[A]){f(C,B,A,y,z)}else{childMenuNav(C,A,y,z)}};window.onMenuNavClick=function(A,z){var y=$("#menu-nav #menu-nav-"+z);y.nextAll(".fg-menu-nav-item").addClass("hidden");var B=$("#menu-"+z);if(!B.hasClass("hidden")){return}c();var B=$("#menu-"+z);var e=B.parent();$("#menu-content").append(B.removeClass("hidden"));u[z]=e};function c(){$("#menu-content ul.fg-menu-content").addClass("hidden");for(var e in u){u[e].append($("#menu-"+e));delete u[e]}}window.resetMenuNav=function(){c();$("#menu-content ul.fg-menu-content:first").removeClass("hidden");$("#menu-nav .fg-menu-nav-item:first").nextAll().addClass("hidden")};function f(B,A,z,e,y){$.ajax({type:"POST",url:contextPath+"/menu.pvt",dataType:"json",cache:true,data:{parentMenuId:A},success:function(C,E){var D=C.childMenus;d(z,D);p[z]=true;childMenuNav(B,z,e,y)},error:function(E,C,D){$.messager.alert($.i18n.get("error"),D||$.i18n.get("prompt.connection.exception"),"error")}})}window.childMenuNav=function(B,A,e,z){$("#menu-content ul.fg-menu-content").addClass("hidden");var C=$("#menu-"+A);var y=C.parent();$("#menu-content").append(C.removeClass("hidden"));u[A]=y;a(B,A,e,z)};function d(z,e){var A=$("#menu-"+z);for(var y=0;y<e.length;y++){A.append(j(z,e[y]))}}function k(y){var z=$('<ul id="menu-'+y.moduleCode+'" class="fg-menu-content hidden">');for(var e=0;e<y.childModules.length;e++){z.append(j(y.moduleCode,y.childModules[e]))}return z}function j(y,z){var C=$('<li class="menu fg-menu-item">');var e=$.i18n.get(z.moduleCode+".name");e=e==undefined?z.moduleName:e;var E=z.moduleIcon;if(z.childModules==undefined||z.childModules.length==0){E=E==null?"tree-file":E;var A=$('<a class="fg-menu-node fg-menu-all"><span class="fg-menu-text">'+e+"</span></a>").linkbutton({plain:true,iconCls:E}).bind("click",function(){onMenuClick(z.moduleCode,e,E,z.actionUrl)});C.append(A)}else{if(z.actionUrl!=""&&z.actionUrl!=undefined){E=E==null?"tree-folder":E;var F=$('<a class="fg-menu-folder fg-menu-left"><span class="fg-menu-text">'+e+'</span>&nbsp;&nbsp;<span class="fg-menu-text-comment">('+z.childModules.length+")</span></a>").linkbutton({plain:true,iconCls:E}).bind("click",function(){onMenuClick(z.moduleCode,e,E,z.actionUrl)});var D=$('<a class="fg-menu-right">').linkbutton({plain:true,iconCls:"menu-rightarrow"}).bind("click",function(){onOpenMenuChild(y,z.moduleId,z.moduleCode,e,E,false)});var B=k(z);C.append(F).append(D).append(B)}else{E=E==null?"tree-folder":E;var A=$('<a class="fg-menu-folder fg-menu-all"><span class="fg-menu-text">'+e+'</span>&nbsp;&nbsp;<span class="fg-menu-text-comment">('+z.childModules.length+')</span><span class="fg-menu-icon menu-rightarrow">&nbsp;</span></a>').linkbutton({plain:true,iconCls:E}).bind("click",function(){onOpenMenuChild(y,z.moduleId,z.moduleCode,e,E,false)});var B=k(z);C.append(A).append(B)}}return C}function a(E,D,e,B){var C=$("#menu-nav #menu-nav-"+D);var z=$.i18n.get(D+".name");e=z==undefined?e:z;var A=C.length==1;if(A){C.removeClass("hidden");C.prev(".fg-menu-nav-item").removeClass("hidden");return}var y=$('<a id="menu-nav-'+D+'" class="fg-menu-nav-item">'+e+"</a>").linkbutton({plain:true,iconCls:B}).bind("click",function(){onMenuNavClick(E,D)});$("#menu-nav").append('<span class="fg-menu-nav-item layout-button-right"></span>').append(y)}s();if(inSetting){infoSetting(inSetting)}if(!andriod){window.menuLock=true}});